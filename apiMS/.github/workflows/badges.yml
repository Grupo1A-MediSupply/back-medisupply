name: ğŸ† Update Badges

on:
  push:
    branches: [ main ]
  workflow_run:
    workflows: ["ğŸ§ª Tests Unitarios - Arquitectura Hexagonal"]
    types:
      - completed

jobs:
  update-badges:
    name: ğŸ“› Actualizar Badges
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
    
    - name: ğŸ“¦ Instalar dependencias
      run: |
        cd microservices
        pip install -r requirements.txt
        pip install -r requirements-test.txt
    
    - name: ğŸ§ª Ejecutar tests y calcular cobertura
      run: |
        cd microservices
        pytest auth-service/tests/unit/ product-service/tests/unit/ \
          --cov=auth-service/domain \
          --cov=product-service/domain \
          --cov-report=xml \
          --cov-report=json
    
    - name: ğŸ“Š Crear badge de cobertura
      run: |
        echo "Coverage badge generado"
        # AquÃ­ se puede integrar con shields.io o genbadge
    
    - name: âœ… Badge de tests
      run: |
        echo "Tests badge: 67 passing"

